# PokerAI Web Backend & Other Serverless Functions

This repository contains a dockerized express server that serves as the backend for the PokerAI web application.


## Getting Started

Install all dependencies:

```bash
cd web-backend
yarn install
```

Run the server in dev mode:

```bash
yarn dev
```

The server will be running on `http://localhost:<PORT FROM ENV>`.

API specification can be found at `http://localhost:<PORT FROM ENV>/api-spec`.

To build the server:

```bash
yarn build
```

### Project Structure

```
.
├── README.md               # This file
└── web-backend             # Express server
    ├── Dockerfile          # Dockerfile for the express server
    ├── api                 # API specification and autogenerated code
    │   ├── generated
    │   └── src
    ├── package.json        # Dependencies and scripts
    ├── src                 # Source code
    │   ├── app.ts          # Express app
    │   ├── config          # Configuration files
    │   ├── controllers     # Request handlers
    │   ├── middleware      # Middleware functions
    │   ├── routes          # Route definitions
    │   ├── server.ts       # Server entry point
    │   └── services        # Business logic
    ├── tsconfig.json
    └── yarn.lock
```

### Environment Variables

Create a `.env` file in the root of the project with the following environment variables:

```
PORT=8080
GCLOUD_ADMIN_KEY=your-gcp-service-account-key-in-json
```

## Datamodel

The data is stored in BigQuery, the schema is as follows:

```mermaid

classDiagram
    class User {
        + andrewId: string
        + teamId: string
    }

    class Team {
        + githubUsername: string
        + elo: number
    }

    class Match {
        + matchId: string
        + team1Name: string
        + team2Name: string
        + team1Bankroll: number
        + team2Bankroll: number
        + timestamp: Date
    }

    User --> Team
    Team --> Match
```